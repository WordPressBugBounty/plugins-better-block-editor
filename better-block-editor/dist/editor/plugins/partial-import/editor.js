(()=>{"use strict";var t={383:(t,e,a)=>{a.d(e,{Xo:()=>r,cs:()=>i,gi:()=>c,qx:()=>l});var n=a(4715),o=a(7143),s=a(3656);function i(){return document.querySelector('iframe[name^="editor-canvas"]')}function r(){var t;return null!==(t=i()?.contentWindow?.document)&&void 0!==t?t:document}async function c(t){await async function(t){if("undefined"!=typeof document)return new Promise((e=>{if("complete"===document.readyState||"interactive"===document.readyState)return t&&t(),e();document.addEventListener("DOMContentLoaded",(()=>{t&&t(),e()}))}))}(),await async function(){return new Promise((t=>{const e=(0,o.subscribe)((()=>{((0,o.select)(s.store).isCleanNewPost()||((0,o.select)(s.store).getEditedPostAttribute("title")||"").trim()||(0,o.select)(n.store).getBlockCount()>0)&&(e(),t())}))}))}(),await async function(){return new Promise((t=>{const e=setInterval((()=>{(async function(){const t=document.querySelector('iframe[name="editor-canvas"]');if(t){const e=t.contentWindow.document;return new Promise((a=>{if("complete"===e.readyState)return a(e);t.contentWindow.addEventListener("load",(()=>a(e)))}))}return new Promise((t=>t(document)))})().then((a=>{const n=a.querySelector(".wp-block[data-block]");if(!isNaN(n?.getBoundingClientRect()?.height))return clearInterval(e),t()}))}),100)}))}(),t()}function l(){var t,e;return null!==(t=null!==(e=(0,o.select)("core/edit-post")?.getEditorMode())&&void 0!==e?e:(0,o.select)("core/edit-site")?.getEditorMode())&&void 0!==t?t:void 0}},4715:t=>{t.exports=window.wp.blockEditor},4997:t=>{t.exports=window.wp.blocks},7143:t=>{t.exports=window.wp.data},3656:t=>{t.exports=window.wp.editor}},e={};function a(n){var o=e[n];if(void 0!==o)return o.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,a),s.exports}a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var n,o,s=a(4997),i=a(7143),r=a(383);const c=window.WPBBE_DATA?.wpbbePasteConfig||{},l=null!==(n=c.debug)&&void 0!==n&&n,d=parseInt(null!==(o=c.batchSize)&&void 0!==o?o:3),u=c.ajaxNonce,g=c.ajaxUrl,m=c.siteUrl;class p{constructor(t){this.enabled=t,this.imageStats={total:0,fromCache:0,newlyDownloaded:0,failed:0,batchesProcessed:0}}debug(...t){this.enabled&&console.debug(...t)}info(...t){this.enabled&&console.info(...t)}log(...t){this.enabled&&console.log(...t)}warn(...t){this.enabled&&console.warn(...t)}error(...t){this.enabled&&console.error(...t)}time(t){this.enabled&&console.time(t)}timeEnd(t){this.enabled&&console.timeEnd(t)}resetStats(){this.imageStats={total:0,fromCache:0,newlyDownloaded:0,failed:0,batchesProcessed:0}}printStats(){if(this.enabled&&(console.log("üñºÔ∏è Image Processing Stats:"),console.log(`  Total images processed: ${this.imageStats.total}`),console.log(`  Images from cache: ${this.imageStats.fromCache}`),console.log(`  Images newly downloaded: ${this.imageStats.newlyDownloaded}`),console.log(`  Failed images: ${this.imageStats.failed}`),console.log(`  Batch requests: ${this.imageStats.batchesProcessed}`),this.imageStats.total>0)){const t=(this.imageStats.fromCache/this.imageStats.total*100).toFixed(1);console.log(`  Cache hit rate: ${t}%`)}}}const h=window.wp.dom;async function b(t,e){return Promise.all(t.map((async t=>{const a=await e(t);return a.innerBlocks&&a.innerBlocks.length?{...a,innerBlocks:await b(a.innerBlocks,e)}:a})))}const f="\x3c!-- wpbbe-import --\x3e",w=new p(l);async function v(t){if(w.debug("Paste event handled in editor",t),t.clipboardData.getData(!1))return void w.debug("It's our own synthetic import paste event, not intercepting");let e=null;try{e=(0,r.Xo)().activeElement}catch(t){w.debug("Error accessing activeElement:",t)}if(["INPUT","TEXTAREA"].includes(e?.tagName))return void w.debug("Paste in text field, not intercepting");w.debug("Intercepting paste event in editor");const a=t.clipboardData,n=a.getData("text/html")||a.getData("text/plain");if(n.includes(f))if(t.preventDefault(),t.stopPropagation(),w.debug("Import marker found, processing pasted content"),"BODY"!==e.tagName)try{if(e&&!e.classList.contains("editor-post-title__input")){const t=e.querySelector("span");t&&(t.setAttribute("data-rich-text-placeholder","Importing..."),t.classList.add("placeholder-pulse"))}const a=await async function(t){w.time("‚ö° Processing pasted content"),w.resetStats(),w.info("Processing pasted HTML:",t.substring(0,100)+(t.length>100?"...":""));const e=(0,s.pasteHandler)({HTML:t});if(e&&e.length){w.info(`Found ${e.length} blocks in pasted content`);const t=[],a=e=>{["core/image","core/cover"].includes(e.name)&&e.attributes.url&&!e.attributes.url.includes(m)&&t.push(e.attributes.url),"wpbbe/svg-inline"===e.name&&e.attributes.imageURL&&!e.attributes.imageURL.includes(m)&&t.push(e.attributes.imageURL);const a=e.attributes?.style?.background?.backgroundImage;return a&&a.url&&!a.url.includes(m)&&t.push(a.url),e};w.time("  ‚Ü™ Collecting image URLs"),await b(e,a),w.timeEnd("  ‚Ü™ Collecting image URLs");let n={};if(t.length>0){const e=[...new Set(t)];w.info(`Found ${e.length} unique external images to process (${t.length-e.length} duplicates)`),n=await async function(t){w.imageStats.total+=t.length,w.time("üîÑ Batch processing images");const e=t;w.info(`‚¨áÔ∏è Processing ${e.length} new images, ${t.length-e.length} from cache`),w.imageStats.fromCache+=t.length-e.length;const a={};let n=0,o=0,s=0;for(let t=0;t<e.length;t+=d){const i=e.slice(t,t+d);w.imageStats.batchesProcessed++,w.info(`  üîÑ Processing batch ${Math.floor(t/d)+1}/${Math.ceil(e.length/d)} (${i.length} images)`);try{const e=new FormData;e.append("action","custom_paste_download_image_batch"),e.append("image_urls",JSON.stringify(i)),e.append("nonce",u),w.time(`  ‚Ü™ AJAX request (batch ${Math.floor(t/d)+1})`);const s=await fetch(g,{method:"POST",credentials:"same-origin",body:e});if(w.timeEnd(`  ‚Ü™ AJAX request (batch ${Math.floor(t/d)+1})`),!s.ok)throw new Error(`Failed to process batch: ${s.statusText}`);const r=await s.json();if(!r.success)throw new Error("WordPress failed to process batch");let c=0;const l=r.data.data||r.data;Object.entries(l).forEach((([t,e])=>{a[t]=e,e.from_cache&&c++}));const m=i.length-c;n+=i.length,o+=c,w.imageStats.newlyDownloaded+=m,w.info(`    ‚úì Batch ${Math.floor(t/d)+1} complete: ${i.length} images processed (${c} from server cache)`)}catch(e){w.error(`    ‚ùå Error processing batch ${Math.floor(t/d)+1}:`),s+=i.length,w.imageStats.failed+=i.length,i.forEach((t=>{a[t]={id:null,url:t,alt:"",caption:""}}))}t+d<e.length&&await new Promise((t=>setTimeout(t,300)))}return w.info(`  ‚ö° Batch processing complete: ${n} successful, ${o} from server cache, ${s} failed`),w.timeEnd("üîÑ Batch processing images"),a}(e)}w.time("  ‚Ü™ Updating blocks with processed images");const o=await b(e,(async t=>{const e=t;if(("core/image"===t.name||"core/cover"===t.name)&&t.attributes.url&&!t.attributes.url.includes(m)){const a=t.attributes.url;if(n[a]){const t=n[a];e.attributes.url=t.url,e.attributes.id=t.id,t.alt&&(e.attributes.alt=t.alt),t.caption&&(e.attributes.caption=t.caption)}}const a=t.attributes?.style?.background?.backgroundImage;if(a&&a.url&&!a.url.includes(m)){const t=a.url;if(n[t]){const a=n[t];e.attributes.style.background.backgroundImage.url=a.url,e.attributes.style.background.backgroundImage.id=a.id}}const o=t.attributes?.imageURL;if(o&&!o.includes(m)&&n[o]){const t=n[o];e.attributes.imageURL=t.url,e.attributes.imageID=t.id}return e}));return w.timeEnd("  ‚Ü™ Updating blocks with processed images"),w.printStats(),w.timeEnd("‚ö° Processing pasted content"),o}return w.timeEnd("‚ö° Processing pasted content"),e}(n.replace(f,"").trim());!function(t,e=[]){const a=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,composed:!0,clipboardData:new DataTransfer}),n=(0,s.serialize)(e);var o;a.clipboardData.setData("text/plain",(o=(o=n).replace(/<br>/g,"\n"),(0,h.__unstableStripHTML)(o).trim().replace(/\n\n+/g,"\n\n"))),a.clipboardData.setData("text/html",n),a.clipboardData.setData("wpbbe-import","true"),t.focus(),t.dispatchEvent(a);const i=new p(l),r=a.clipboardData.getData("text/html")||a.clipboardData.getData("text/plain");i.info(`Synthetic paste event triggered with payload: "${r}"`)}(t.target,a)}catch(t){w.error("Error processing pasted content:")}else w.debug("No paste target block, pasting to <BODY> is not supported.");else w.debug("No import marker found, stop intercepting paste")}function y(){if((0,r.Xo)().addEventListener("paste",v,!0),w.info("Paste handler attached to editor"),(0,r.cs)()){const t=document;t.addEventListener("paste",(async e=>{const a=t.querySelector(":where(#editor,#site-editor) .editor-list-view-sidebar .editor-list-view-sidebar__list-view-panel-content");a&&a.contains(e.target)&&v(e)}),{capture:!0}),w.info("Paste handler attached to main document (iframe mode).")}}let P,S=(0,r.qx)();(0,i.subscribe)((()=>{const t=(0,r.qx)();t&&t!==S&&(w.debug("Editor mode changed to:",t),S=t,"visual"===t&&(0,r.gi)((()=>{(0,r.cs)()&&(w.debug("Reattached paste handler to iframe after switching to visual mode."),y())})))})),(0,i.subscribe)((()=>{const t=(0,i.select)("core/editor").getCurrentPostId();t!==P&&(P=t,w.debug(`Post ID changed from ${P} to ${t}, reattaching paste handler.`),(0,r.gi)((()=>{y()})))}))})();